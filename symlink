#!/usr/bin/env bash

# Spit all my configuration files into the right place.
# Works as of Ubuntu 16.04

DOTDIR="$HOME/dotfiles/dotfiles"

mkdir -p ${XDG_CONFIG_HOME:=$HOME/.irssi}
mkdir -p ${XDG_CONFIG_HOME:=$HOME/.config}
cd $DOTDIR

# delete all dotfiles present, suppress stderr
for f in *; do
  if [[ $f = "irssi_config" ]] ; then rm ~/.irssi/config 2> /dev/null; fi
  if [[ $f = "muttrc" ]] ; then rm ~/.mutt/$f 2> /dev/null; fi
  if [[ $f = "config.yaml" ]] ; then rm ~/.stack/$f 2> /dev/null; fi
  if [[ $f = "init.vim" ]] ; then rm ~/.config/nvim/$f 2> /dev/null; fi
  if [[ $f = "words" ]] ; then rm ~/.config/nvim/spell/*.add && rm ~/.ispell_british 2> /dev/null; fi
  if [[ $f = "newsbeuter_config" ]] ; then rm ~/.newsbeuter/config; fi
  if [[ $f = "urls" ]] ; then rm ~/.newsbeuter/urls; fi
  rm ~/.$f 2> /dev/null;
done

# symlink all dotfiles (taking care of irregular file paths)
for f in *; do
  if [[ $f = "irssi_config" ]] ;
  then
    ln -s $(realpath ./$f) ~/.irssi/config
    file ~/.irssi/config
  elif [[ $f = "config.yaml" ]] ;
  then
    ln -s $(realpath ./$f) ~/.stack/$f
    file ~/.stack/$f
  elif [[ $f = "muttrc" ]] ;
  then
    ln -s $(realpath ./$f) ~/.mutt/$f
    file ~/.mutt/$f
  elif [[ $f = "newsbeuter_config" ]] ;
  then
    ln -s $(realpath ./$f) ~/.newsbeuter/config
    file ~/.newsbeuter/config
  elif [[ $f = "urls" ]] ;
  then
    ln -s $(realpath ./$f) ~/.newsbeuter/urls
    file ~/.newsbeuter/urls
  elif [[ $f = "init.vim" ]] ;
  then
    ln -s $(realpath ./$f) ~/.config/nvim/$f
    file ~/.config/nvim/$f
  elif [[ $f = "words" ]] ;
  then
    # Use same word file for Vim and Ispell
    ln -s $(realpath ./$f) ~/.config/nvim/spell/en.utf-8.add
    file ~/.config/nvim/spell/en.utf-8.add

    ln -s $(realpath ./$f) ~/.ispell_british
    file ~/.ispell_british
  else
    # stick everything else in ~/ as a dotfile
    ln -s $(realpath ./$f) ~/.$f
    file ~/.$f
  fi
done
